(function(){$(function(){var e,t,a,i,r,n,o,d,s,l,c,u,p,f,h,v,m,g,y,b,w,I,V,C,D,B,E,k,x,S,T,L,M,P,j,A,O,R,z,Y,_,J,K,N,F,U,G,H,W,Q,X;return p={},H={},B={},o={},D={},L={},V=0,f=new Showdown.converter,T={},W={},e={},E={},G=640/360,F={},j="",v="",u=0,s=!1,h={},Q=!1,X=0,d=[],C=!1,M={},P={spanish:"3779128128001",french:"3780031778001",polish:"3779128125001",italian:"3779128126001",japanese:"3779128119001",brazilian:"3780202967001",turkish:"3779128127001","default":"3779128126001"},K=["spain","mexico","chile","argentina","france","poland","italy","turkey","japan","colombia","brazil"],I=function(){return _(),i(),Y(w())},A=function(e){return V+=e,6===V?(O(),I(),V=0):void 0},y=function(){return $.ajax("http://freegeoip.net/json/",{type:"GET",dataType:"json",timeout:3e3,error:function(e,t,a){return console.log(""+t),v="default",b(),U(P["default"],v)},success:function(e,t,a){return v=e.country_name,console.log("Country: "+v),v=v.toLowerCase(),"japan"===v&&(s=!0,$("#caption-toggle .captions").addClass("active"),$("#caption-toggle .captions-text").addClass("active").empty().text("Subtitles On")),b(),U(P["default"],v)}})},U=function(e,t){return M={playerID:"1890493041001",playerKey:"AQ~~%2CAAABuJ3Komk~%2CgXybzBdQzgLgC0zHvAZXtMeryIVplW-t",width:$(window).width()/1.5,height:$(window).width()/1.5/G,videoID:""+e},j='<div style="display:none"></div><object id="myExperience" class="BrightcoveExperience"><param name="bgcolor" value="#FFFFFF" /><param name="width" value="{{width}}" /><param name="height" value="{{height}}" /><param name="playerID" value="{{playerID}}" /><param name="playerKey" value="{{playerKey}}" /><param name="isSlim" value="true" /><param name="autoStart" value="false" /><param name="isVid" value="true" /><param name="isUI" value="true" /><param name="dynamicStreaming" value="true" /><param name="@videoPlayer" value="{{videoID}}"; /><param name="includeAPI" value="true" /><param name="linkBaseURL" value="http://www.redbullmusicacademy.com/magazine/diggin-in-the-carts"/><param name="templateLoadHandler" value="onTemplateLoad" /><param name="templateReadyHandler" value="onTemplateReady" /></object>',v=t.toLowerCase(),K.indexOf(v)>-1?$("#caption-toggle").show():void 0},Y=function(e){var t,a;return t={height:e},a=JSON.stringify(t),window.parent.postMessage(a,"*")},w=function(){return $(document.body).height()},i=function(){var e,t;return t=Handlebars.compile(j),e=t(M),document.getElementById("player").innerHTML=e,brightcove.createExperiences()},window.onTemplateLoad=function(t){return T=brightcove.api.getExperience(t),e=brightcove.api.modules.APIModules,E=T.getModule(brightcove.api.modules.APIModules.VIDEO_PLAYER),makeCaptionOverlay()},window.onTemplateReady=function(t){return W=T.getModule(e.VIDEO_PLAYER),R($("#myExperience")),E.addEventListener(brightcove.api.events.MediaEvent.BEGIN,k),E.addEventListener(brightcove.api.events.MediaEvent.CHANGE,k),E.addEventListener(brightcove.api.events.MediaEvent.COMPLETE,k),E.addEventListener(brightcove.api.events.MediaEvent.ERROR,k),E.addEventListener(brightcove.api.events.MediaEvent.PLAY,k),E.addEventListener(brightcove.api.events.MediaEvent.STOP,k),Y(w())},$("#caption-toggle").click(function(e){var t;if(e.stopPropagation(),e.preventDefault(),t=$(this).data("order"),F=H[t],$(this).hasClass("unreleased"));else{if(s)return s=!1,$("#caption-toggle .captions").removeClass("active"),$("#caption-toggle .captions-text").removeClass("active").empty().text("Subtitles Off"),W.loadVideoByID(P["default"]);if(!s)switch(s=!0,$("#caption-toggle .captions").addClass("active"),$("#caption-toggle .captions-text").addClass("active").empty().text("Subtitles On"),v){case"france":return W.loadVideoByID(F.fields.brightcoveVideoIdFrench);case"japan":return W.loadVideoByID(F.fields.brightcoveVideoIdJapanese);case"turkey":return W.loadVideoByID(F.fields.brightcoveVideoIdTurkish);case"brazil":return W.loadVideoByID(F.fields.brightVideoIdBrazil);case"italy":return W.loadVideoByID(F.fields.brightcoveVideoIdItalian);case"spain":return W.loadVideoByID(F.fields.brightcoveVideoIdSpanish);case"mexico":return W.loadVideoByID(F.fields.brightcoveVideoIdSpanish);case"argentina":return W.loadVideoByID(F.fields.brightcoveVideoIdSpanish);case"colombia":return W.loadVideoByID(F.fields.brightcoveVideoIdSpanish);case"chile":return W.loadVideoByID(F.fields.brightcoveVideoIdSpanish);case"poland":return W.loadVideoByID(F.fields.brightcoveVideoIdPolish);default:return E.loadVideoByID(F.fields.brightcoveVideoId)}}}),x=function(e){return X=e.position},k=function(e){return"mediaBegin"===e.type?Q=!0:"mediaStop"===e.type?Q=!1:void 0},N=function(e){return E.getCurrentVideo(m)},m=function(e,t){if(s)switch(v){case"france":E.loadVideoByID(F.fields.brightcoveVideoIdFrench);break;case"japan":W.loadVideoByID(F.fields.brightcoveVideoIdJapanese);break;case"turkey":E.loadVideoByID(F.fields.brightcoveVideoIdTurkish);break;case"brazil":E.loadVideoByID(F.fields.brightVideoIdBrazil);break;case"italy":E.loadVideoByID(F.fields.brightcoveVideoIdItalian);break;case"spain":E.loadVideoByID(F.fields.brightcoveVideoIdSpanish);break;case"mexico":E.loadVideoByID(F.fields.brightcoveVideoIdSpanish);break;case"argentina":E.loadVideoByID(F.fields.brightcoveVideoIdSpanish);break;case"colombia":E.loadVideoByID(F.fields.brightcoveVideoIdSpanish);break;case"chile":E.loadVideoByID(F.fields.brightcoveVideoIdSpanish);break;default:E.loadVideoByID(F.fields.brightcoveVideoId)}else W.loadVideoByID(F.fields.brightcoveVideoId);return $(".videos h1").empty().text(F.fields.episodeTitle)},R=function(e){var t,a,i,r,n,o,d,s,l,c,u;return l=e,n=l.attr("width"),r=l.attr("height"),u=$(window).width(),o=n/r,C?void(l.attr("src")&&(s=l.attr("src"),d=/width=([\d\.]*).*height=([\d\.]*)/,i=s.replace(d,""),l.attr("src",i))):(c=u/1.6,l.attr("width",c),l.attr("height",c/o),t=u-c,a=t/2,l.css({marginLeft:a,marginRight:a,opacity:1}))},J=function(){var e,t;return t=document.createElement("script"),t.src="https://www.youtube.com/iframe_api",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)},window.onYouTubeIframeAPIReady=function(){return L=new YT.Player("storyplayer",{height:"39",width:"64",videoId:"-Ct_vEPmmq4",events:{onReady:S},playerVars:{modestbranding:!0,controls:1,showinfo:0,hd:1,origin:"http://www.redbullmusicacademy.com"}})},S=function(e){return z("#storyplayer")},_=function(){return window.addEventListener("resize",function(){return z($("#myExperience")),z($("#storyplayer"))}),$("a.arrow-right").click(function(e){var t,a,i,r,n;return e.preventDefault(),t=$(".composers-wrap"),n=t.find(".slide").length,i=t.find(".active"),a=i.data("order"),n-2>=a?(r=t.find("[data-order="+(a+1)+"]"),i.removeClass("active"),r.addClass("active")):(r=t.find("[data-order=0]"),i.removeClass("active"),r.addClass("active"))}),$("a.arrow-left").click(function(e){var t,a,i,r,n;return e.preventDefault(),t=$(".composers-wrap"),n=t.find(".slide").length,i=t.find(".active"),a=i.data("order"),a>=1?(r=t.find("[data-order="+(a-1)+"]"),i.removeClass("active"),r.addClass("active")):(r=t.find("[data-order="+(n-1)+"]"),i.removeClass("active"),r.addClass("active"))})},c=function(e,t,a){var i;return i=a[t].fields,e.find("li").hasClass("unreleased")?void $(".videos h1").empty().text(i.episodeTitle):(player1.cueVideoById(i.ytVideoId),$(".videos h1").empty().text(i.episodeTitle))},l=function(e,t){var a;return a=t[e].fields,L.cueVideoById(a.additionalYouTube),$(".stories h1").empty().text(a.additionalVideoTitle),$(".stories p.body").empty().text("japan"===v?a.japaneseDescription:a.description),$(".stories p.body").slideDown()},n=function(e,t,a){var i,r,n,o,d,s,l,c,u,p,f;if("main"===a){for(p=[],o=s=0,c=e.length;c>s;o=++s)d=e[o],r=d.fields.episodeNumber,i=new Date,n=new Date("japan"===v?d.fields.datetimeOfLaunchJapan:d.fields.datetimeOfLaunch),t.append(moment()<n?"<a class='episode' href data-order="+o+"><li class='unreleased' data-release='"+n+"'>"+r+"</li>":"<a class='episode' href data-order="+o+"><li class='released'>"+r+"</li>"),p.push(t.find("li").each(function(){var e,t,a,i;return i=$(this),i.hasClass("unreleased")?(t=i.text(),a=i.data("release"),e=new Date(a),i.bind("mouseenter",function(){return i.empty().text(moment(a).format("ddd, MMM Do"))}),i.bind("mouseleave",function(){})):void 0}));return p}if("additional"===a){for(f=[],o=l=0,u=e.length;u>l;o=++l)d=e[o],r=d.fields.additionalVideoTitle,f.push(t.append("<a class='additional-episode' href data-order="+o+"><li>"+r+"</li>"));return f}},t=function(e){var t,a,i,r,n,o,d,s,l,c;for(c=[],i=s=0,l=e.length;l>s;i=++s)t=e[i],o=t.fields,n=o.composerName,r=o.image.fields.file.url,d=f.makeHtml("japan"===v?o.japaneseBio?o.japaneseBio:o.bio:o.bio),a="<div class='slide' data-order='"+i+"'><div class='img-wrap'><a class='arrow-left' href></a><a class='arrow-right' href></a><img src='"+r+"'/></div><h2>"+o.composerName+"</h2><p>"+d+"</p></div>",$(".composers-wrap").append(a),c.push($(".slide").first().addClass("active"));return c},a=function(e){var t,a,i,r,n,o,d,s,l,c;for(c=[],s=0,l=e.length;l>s;s++)r=e[s],o=r.fields,d=o.artistName,i=o.artistImage.fields.file.url,t=o.descriptions?o.descriptions:"",a=o.rbmaRadioEmbedCode?o.rbmaRadioEmbedCode:"",n="<div class='show'><img src='"+i+"'/>"+a+"<p>"+t+"</p></div>",c.push($(".radio").append(n));return c},z=function(e){var t,a,i,r,n,o,d;return T=$(e),d=$(window).width(),o=d/1.6,r=T.attr("width"),i=T.attr("height"),n=r/i,C&&(o=d/1.4),T.attr("width",o),T.attr("height",o/n),t=d-o,a=t/2,T.css({marginLeft:a,display:"block"}),Y(w())},O=function(){return $(".spinner").fadeOut(function(){return $(".spinner").remove()})},g=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?C=!0:void 0},r=function(e){var t,a,i,r,n;return r=$(".twitter-share"),i=$(".facebook-share"),v=v.toLowerCase(),"japan"===v?(n=e.twitterShareTextJapan,t=e.facebookShareTextJapan):(n=e.twitterShareText,a=e.facebookShareText),r.attr("href","http://twitter.com/intent/tweet?text="+n),i.attr("href","https://www.facebook.com/sharer/sharer.php?u=http://www.redbullmusicacademy.com/magazine/diggin-in-the-carts&amp;t="+a)},b=function(){var e;return e=contentful.createClient({accessToken:"38b8dbaf503a350d5722578c6547caca484511f7c78717736ac8f576832be4b0",space:"s9bc5ah7p1d5"}),e.entries({content_type:"42CpXYSUms44OskS6wUU6I",include:1,order:"sys.updatedAt"}).done(function(e){return t(e),A(1)}),e.entries({content_type:"36SuQSSPR6QmWOk8CseMC6",include:1,order:"fields.order"}).done(function(e){return H=e,A(1),n(H,$(".video-nav ul"),"main"),$("a.episode").bind("click",function(e){var t;return e.preventDefault(),$(this).parent().find("li").removeClass("active"),$(this).find("li").addClass("active"),t=$(this).data("order"),F=H[t],$("#caption-toggle").data("order",t),$(this).children("li").hasClass("unreleased")?void $("#caption-toggle").addClass("unreleased"):($("#caption-toggle").removeClass("unreleased"),N())})}),e.entries({content_type:"2YpXtnGW80EEGgCUsSMmCc",include:1,order:"fields.order"}).done(function(e){return A(1),a(e)}),e.entries({content_type:"6fwxAcXrxK4yqyaMUiWwWY",include:1,order:"fields.order"}).done(function(e){return A(1),o=e,n(o,$(".story-nav ul"),"additional"),$("a.additional-episode").bind("click",function(e){var t;return e.preventDefault(),$(this).parent().find("li").removeClass("active"),$(this).find("li").addClass("active"),t=$(this).data("order"),l(t,o)}),J()}),e.entries({content_type:"3JB3iYStpCGYGuu24mEcQK",include:1}).done(function(e){return A(1),$("footer p").empty().text("japan"===v?e[0].fields.bodyJapanese:e[0].fields.body)}),e.entries({content_type:"5KnZeYIgc8oUo2cgssKAWK",include:1}).done(function(e){var t;return t=e[0].fields,A(1),r(t)})},y(),g(),$(".pulldown").click(function(e){return e.stopPropagation(),e.preventDefault(),$(this).parent().find("ul").slideToggle(400,"linear",function(){return Y(w())})})})}).call(this);